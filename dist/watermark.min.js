!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).WaterMark={})}(this,(function(t){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t,e){return t(e={exports:{}},e.exports),e.exports}var n=e(o((function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports}))),r=e(o((function(t){function e(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports})));function i(t){if(!(this instanceof i))return new i(t);this.watermark=t,this.MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,this.watermarkDom,this.oldOpts={width:0,height:0},this.option={childList:!0,attributes:!0,subtree:!0,attributeFilter:["style"],attributeOldValue:!0}}i.prototype.init=function(){if(this.MutationObserver){var t=this.callback(this.watermark);this.watermarkDom=new this.MutationObserver(t)}},i.prototype.callback=function(t){return function(e){e.length>0&&t.render()}},i.prototype.onListener=function(t,e){if(e.monitor&&this.watermarkDom){var o=document.getElementById(t.boxId);o&&(this.watermarkDom.observe(o,this.option),o.shadowRoot&&this.watermarkDom.observe(o.shadowRoot,this.option))}},i.prototype.removeListener=function(){this.watermarkDom&&this.watermarkDom.disconnect()};var a={MutationListener:i};function s(t){if(!(this instanceof s))return new s(t)}s.prototype.create=function(t,e,o){var n=this.createCanvas(e,o),r=document.createElement("div"),i=n.toDataURL(),a="\n    position:absolute;\n    top:0;\n    left:0;\n    bottom:0;\n    right:0;\n    width:100%;\n    height:100%;\n    pointer-events:none;\n    background-repeat:repeat;\n    background-image:url('".concat(i,"')");r.setAttribute("style",a),t.appendChild(r)},s.prototype.createCanvas=function(t,e){var o=document.createElement("canvas"),n=Math.max(t.boxWidth,t.boxHeight);o.setAttribute("width",n),o.setAttribute("height",n);var r=o.getContext("2d");return r.textAlign=e.textAlign,r.textBaseline=t.boxHeight,r.font=e.fontSize+""+e.fontFamily,r.fillStyle="rgba(184, 184, 184, ".concat(e.fontAlpha,")"),r.rotate(e.rotateAngle),r.fillText(e.content,parseFloat(t.boxWidth)/2,parseFloat(t.boxHeight)/2),o},s.prototype.calaCtxData=function(t,e,o){var n,r;switch(t=t.data,e=e.data,o){case"R":n=0,r=3;break;case"G":n=1,r=2;break;case"B":n=2,r=1}for(var i=0;i<t.length;i++)i%4==n&&(0===e[i+r]&&t[i]%2==1||0!==e[i+r]&&t[i]%2==0)&&(255===t[i]?t[i]--:t[i]++);return t};var l={Canvas:s};function c(t){if(!(this instanceof c))return new c(t)}c.prototype.create=function(t,e,o){for(var n,r,i=0;i<e.rows;i++){r=e.y+(e.pageHeight-e.allHeight)/2+(e.ySpace+e.boxHeight)*i;for(var a=0;a<e.cols;a++){n=e.x+(e.pageWidth-e.allWidth)/2+(e.xSpace+e.boxWidth)*a;var s=this.createItem(n,r,i,a,e,o);t.appendChild(s)}}},c.prototype.createItem=function(t,e,o,n,r,i){var a=document.createElement("div"),s=document.createTextNode(i.content);return a.appendChild(s),a.id=r.boxId+"_"+o+n,a.style.webkitTransform="rotate(-"+i.rotateAngle+"deg)",a.style.MozTransform="rotate(-"+i.rotateAngle+"deg)",a.style.msTransform="rotate(-"+i.rotateAngle+"deg)",a.style.OTransform="rotate(-"+i.rotateAngle+"deg)",a.style.transform="rotate(-"+i.rotateAngle+"deg)",a.style.visibility="",a.style.position=i.position,a.style.zIndex=i.zIndex,a.style.left=t+"px",a.style.top=e+"px",a.style.overflow="hidden",a.style.pointerEvents="none",a.style.opacity=i.fontAlpha,a.style.filter="alpha(opacity="+i.fontAlpha+"100)",a.style.fontSize=i.fontSize,a.style.fontFamily=i.fontFamily,a.style.lineHeight=i.fontSize,a.style.color=i.fontColor,a.style.textAlign=i.textAlign,a.style.width=r.boxWidth+"px",a.style.height=r.boxHeight+"px",a.style.display="block",a.style["-ms-user-select"]="none",a};var p={ShadowRoot:c},u=o((function(t){function e(o){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(o)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports})),h=e(u);var f=function(t){return"[object Object]"==Object.prototype.toString.call(t)&&null!==t};var d=function(t){return"[object Function]"==Object.prototype.toString.call(t)};var y=function(t){return"[object Array]"==Object.prototype.toString.call(t)};var v=function(t){return"[object String]"==Object.prototype.toString.call(t)};var m=function(t){return"[object Number]"==Object.prototype.toString.call(t)};var x=function(t){return t instanceof Date};function b(t){return"[object Undefined]"==Object.prototype.toString.call(t)}var g,w,S,E,O=function(){var t=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var o=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?o:3&o|8).toString(16)}))};Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,o=Number(arguments[1])||0;for(o<0&&(o+=e);o<e;){if(o in this&&this[o]===t)return o;o++}return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var o=arguments[1],n=0;n<e;n++)n in this&&t.call(o,this[n],n,this)}),Array.prototype.map||(Array.prototype.map=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var o=new Array(e),n=arguments[1],r=0;r<e;r++)r in this&&(o[r]=t.call(n,this[r],r,this));return o}),Array.prototype.filter||(Array.prototype.filter=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var o=new Array,n=arguments[1],r=0;r<e;r++)r in this&&t.call(n,this[r],r,this)&&o.push(val);return o}),Array.prototype.some||(Array.prototype.some=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var o=arguments[1],n=0;n<e;n++)if(n in this&&t.call(o,this[n],n,this))return!0;return!1}),Array.prototype.every||(Array.prototype.every=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var o=arguments[1],n=0;n<e;n++)if(n in this&&!t.call(o,this[n],n,this))return!1;return!0}),Object.keys||(Object.keys=(g=Object.prototype.hasOwnProperty,w=!{toString:null}.propertyIsEnumerable("toString"),E=(S=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(t){if("object"!==h(t)&&"function"!=typeof t||null===t)throw new TypeError("Object.keys called on non-object");var e=[];for(var o in t)g.call(t,o)&&e.push(o);if(w)for(var n=0;n<E;n++)g.call(t,S[n])&&e.push(S[n]);return e})),Object.assign||(Object.assign=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(o[i]=r[i])}return o});var k=function(t,e,o){var n,r,i;function a(){return setTimeout((function(){o.immedi||(t.apply(r,i),r=i=null)}),e)}return o=o||{},function(){r=this,i=Array.prototype.slice.call(arguments,0),clearTimeout(n),n=a(),o.immedi&&t.apply(r,i)}};var A=function(){var t=navigator.userAgent,e=t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1;if(e){new RegExp("MSIE (\\d+\\.\\d+);").test(t);var o=parseFloat(RegExp.$1)}return{is:e,v:o}},j={isObject:f,isFun:d,isArray:y,isString:v,isNumber:m,isDate:x,getUUId:O,assign:function(t,e){if("object"===h(e=e||{}))for(var o in e)b(e[o])||(t[o]=e[o]);return t},debounce:k,simulatedEvent:function(t,e,o,n){var r={canBubble:!0,cancelable:!0,eventType:"HTMLEvents"};n=Object.assign(r,n||{}),"object"==h(o)&&(n=Object.assign(r,o),o=void 0);var i="[object String]"===Object.prototype.toString.call(t)?document.getElementById(t):t,a=document.createEvent(n.eventType);a.initEvent(e,n.canBubble,n.cancelable),o&&i&&(i.value=o),i&&i.dispatchEvent(a)},mockMouse:function(t,e){var o="[object String]"==Object.prototype.toString.call(t)?document.getElementById(t):t,n=document.createEvent("MouseEvents");n.initMouseEvent("mousedown",!0,!0,window,0,e.x,e.y,e.x,e.y,!1,!1,!1,!1,0,null),o.dispatchEvent(n)},isIE:A};function M(){if(!(this instanceof M))return new M;this.type=window.addEventListener?1:2}M.prototype.on=function(t,e,o,n){1===this.type?t.addEventListener(e,o,n):t.attachEvent("on"+e,o)},M.prototype.off=function(t,e,o,n){1===this.type?t.removeEventListener(e,o):t.detachEvent(e,o)},M.prototype.dispatch=function(t,e){return t.dispatchEvent(e)};var I={EventListener:M},W=l.Canvas,_=p.ShadowRoot,L=j.isFun,T=j.mockMouse,H=j.isIE,z=new(0,I.EventListener);function C(t){if(!(this instanceof C))return new C(t);this.type=L(document.createElement("div").attachShadow?1:document.createElement("canvas").getContext?2:3),this.init(t),this._opts=t}C.prototype.init=function(t){this.shadowRoot=this.getShadowRoot(t,t.containerBox)},C.prototype.render=function(t){var e=this._opts;(2!==this.type?new _:new W).create(1===this.type?this.shadowRoot.attachShadow({mode:"open"}):this.shadowRoot,e,t),this.insertDom(e.containerBox,this.shadowRoot);var o=H();o.is&&11!=o.v&&this.eventPenetrate(e)},C.prototype.getShadowRoot=function(t){var e=document.createElement("div");return e.id=t.boxId,e.setAttribute("style","pointer-events: none !important; display: block !important"),e.style.position="absolute",e.style.zIndex=1e4,e.style.top=0,e.style.left=0,e.style.minWidth="100%",e.style.minHeight="100%",e},C.prototype.insertDom=function(t,e){var o=t.children,n=Math.floor(Math.random()*(o.length-1));o[n]?t.insertBefore(e,o[n]):t.appendChild(e)},C.prototype.eventPenetrate=function(t){z.on(document.getElementById(t.boxId),"mousedown",(function(t){this.style.display="none";var e=document.elementFromPoint(t.clientX,t.clientY);return T(e,{x:t.clientX,y:t.clientY}),this.style.display="block",!1}))};var R=a.MutationListener,B={Adapter:C}.Adapter,F=j.getUUId;function D(t){if(!(this instanceof D))return new D(t);this.mutationListener=new R(this),this.mutationListener.init(),this.key=F()}D.prototype.init=function(t){this.opts=t||{};var e={boxId:t.boxId+"_"+this.key,pageOffTop:0,pageOffLeft:0,x:0,y:0,pageWidth:null,pageHeight:null,cols:0,rows:0,allWidth:0,allHeight:0};e.x=t.x+e.pageOffLeft,e.y=t.y+e.pageOffTop;var o=e.containerBox=t.containerNode&&document.getElementById(t.containerNode)||document.body;return this._calaBoxSize(e,t),this._getPageWidthHeight(e,o),this._caleMarkCount(e,t),this._calcTotalLength(e,t,o),this._opts=e,this},D.prototype.render=function(){console.log("渲染 水印！");var t=this.opts,e=this._opts;this.clear(e),new B(e).render(t),this.mutationListener.onListener(e,t)},D.prototype._calaBoxSize=function(t,e){var o=document.createElement("span");o.style.visibility="hidden",o.style.fontSize=e.fontSize,o.style.lineHeight=e.fontSize,o.style.overflow="hidden",o.style.whiteSpace="nowrap",o.style.textOverflow="ellipsis",o.style.position="absolute",o.style.boxSizing="border-box",o.style.width="-webkit-max-content",o.style.width="-moz-max-content",o.style.width="max-content",document.body.appendChild(o),void 0!==o.textContent?o.textContent=e.content:o.innerText=e.content,t.boxWidth=o.offsetWidth+10,t.boxHeight=o.offsetHeight+2,console.log(t,o.offsetWidth,o.clientWidth,o.scrollWidth,o.width),o.parentNode.removeChild(o)},D.prototype._getPageWidthHeight=function(t,e){t.pageWidth=Math.max(e.scrollWidth,e.clientWidth),t.pageHeight=Math.max(e.scrollHeight,e.clientHeight)},D.prototype._caleMarkCount=function(t,e){t.cols=parseInt((t.pageWidth-t.x)/(t.boxWidth+e.xSpace)),t.xSpace=parseInt((t.pageWidth-t.x-t.boxWidth*t.cols)/t.cols),t.rows=parseInt((t.pageHeight-t.y)/(t.boxHeight+e.ySpace)),t.ySpace=parseInt((t.pageHeight-t.y-t.boxHeight*t.rows)/t.rows)},D.prototype._calcTotalLength=function(t,e){t.allWidth=t.x+t.boxWidth*t.cols+t.xSpace*(t.cols-1),t.allHeight=t.y+t.boxHeight*t.rows+t.ySpace*(t.rows-1)},D.prototype.clear=function(t){var e,o=document.getElementById(t.boxId);null==o||null===(e=o.parentNode)||void 0===e||e.removeChild(o),this.mutationListener.removeListener()},D.prototype.remove=function(){this.clear(),this.mutationListener.removeListener()};var P={WaterMark:D}.WaterMark,N=j.debounce,U=j.assign,Y={defaultOpt:{boxId:"wm_container_id",content:"",x:0,y:0,xSpace:0,ySpace:0,fontColor:"#000000",fontAlpha:.1,fontSize:"12px",fontFamily:"Microsoft Yahei",rotateAngle:20,bgAlpha:.1,position:"absolute",zIndex:100,textAlign:"center",monitor:!0,containerNode:null,coverAreaId:null,onLoad:!0,onResize:!0}}.defaultOpt,X=new(0,I.EventListener),G=function(){function t(e){n(this,t);var o=U({},Y);this.opts=U(o,e||{});var r=this.watermark=new P;this._debounceFn=N((function(t){r.init(t).render()}),1e3)}return r(t,[{key:"init",value:function(){var t=this,e=this.opts;this.reload(e),e.onLoad&&X.on(window,"load",(function(){t._debounceFn(e)})),e.onResize&&X.on(window,"resize",(function(){t._debounceFn(e)}))}},{key:"reload",value:function(t){var e;t&&(e=U({},Y),this.opts=e=U(e,t||{})),this.watermark.init(e).render()}},{key:"remove",value:function(){this.opts.onLoad&&X.off(window,"load"),this.opts.onResize&&X.off(window,"resize"),this.watermark.status=!1,this.watermark.remove()}}]),t}(),K=G,V={WaterMark:K};t.WaterMark=K,t.default=V,Object.defineProperty(t,"__esModule",{value:!0})}));
